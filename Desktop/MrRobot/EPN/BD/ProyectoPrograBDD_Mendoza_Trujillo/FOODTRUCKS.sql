
/*CREACION DE BASE DE DATOS*/
CREATE DATABASE FOODTRUCKS

/*CREACION DE TABLAS*/
/*CLIENTE*/
USE FOODTRUCKS
CREATE TABLE CLIENTES
( NomCliente varchar(25),
ApeCliente varchar(25),
IDCliente numeric(10) primary key,
DirCli varchar(50),
FechNacCli date,
TelfCliente numeric(10),
CorreoCli varchar (40)
)

/*PRODUCTOS*/
USE FOODTRUCKS
CREATE TABLE PRODUCTOS
( CodProd numeric(10) primary key,
NomProd varchar(59),
PrecioProd decimal(3,2),
StockProd numeric(5),
CategoriaProd numeric(1) 
)
/*FACTURA*/
USE FOODTRUCKS
CREATE TABLE FACTURA
(CodFactura numeric(6) primary key,
FechFactura date,
PrecioUnit numeric(4,2),
Cantidad numeric(6),
TotalFact numeric(6,2),
Descuento numeric(4,2),
APagar numeric(4,2)
)

USE FOODTRUCKS
CREATE TABLE FORMA_PAGO
(IdPago numeric(6) primary key,
FormaPago numeric(1),
)

/*ADMINISTRADOR*/
USE FOODTRUCKS
CREATE TABLE ADMINISTRADOR
(NomAdmin varchar(25),
ApeAdmin varchar(25),
IdAdmin numeric(10) primary key,
DirAdmin varchar(50),
FechNacAdmin date,
TelfAdimin numeric(10),
CorreoAdmin varchar(50))

/*INVENTARIO*/
USE FOODTRUCKS
CREATE TABLE INVENTARIOS
(CodInv numeric(5) primary key,
Insumo varchar(25),
Existencias numeric(5),
Estado bit not null default 1
)

USE FOODTRUCKS
CREATE TABLE VENTAS
(CodVentas numeric(5) primary key,
Cantidad numeric(5))

/*RELACIONES*/
USE FOODTRUCKS
ALTER TABLE FACTURA
ADD FK_IDCliente numeric(10)
CONSTRAINT CLIENTES_FACTURA FOREIGN KEY
REFERENCES CLIENTES(IDCliente)


USE FOODTRUCKS
ALTER TABLE FACTURA
ADD FK_CodProd numeric(10)
CONSTRAINT PRODUCTOS_FACTURA FOREIGN KEY
REFERENCES PRODUCTOS(CodProd)

USE FOODTRUCKS
ALTER TABLE FACTURA
ADD FK_IdAdmin NUMERIC(10)
CONSTRAINT ADMINISTRADOR_FACTURA FOREIGN KEY
REFERENCES ADMINISTRADOR(IdAdmin)

USE FOODTRUCKS
ALTER TABLE FORMA_PAGO
ADD FK_CodFactura NUMERIC(6)
CONSTRAINT FACTURA_FORMA_PAGO FOREIGN KEY
REFERENCES FACTURA(CodFactura)

USE FOODTRUCKS
ALTER TABLE FORMA_PAGO
ADD FK_IDCliente NUMERIC(10)
CONSTRAINT CLIENTES_FORMA_PAGO FOREIGN KEY
REFERENCES CLIENTES(IDCliente)
  
USE FOODTRUCKS
ALTER TABLE FORMA_PAGO
ADD FK_IdAdmin NUMERIC(10)
CONSTRAINT ADMINISTRADOR_FORMA_PAGO FOREIGN KEY
REFERENCES ADMINISTRADOR(IdAdmin)

USE FOODTRUCKS
ALTER TABLE INVENTARIOS
ADD FKIdAdmin NUMERIC(10)
CONSTRAINT ADMINISTRADOR_INVENTARIOS FOREIGN KEY
REFERENCES ADMINISTRADOR(IdAdmin)

USE FOODTRUCKS
ALTER TABLE VENTAS
ADD FKCodProd numeric(10)
CONSTRAINT PRODUCTOS_VENTAS FOREIGN KEY
REFERENCES PRODUCTOS(CodProd)

USE FOODTRUCKS
ALTER TABLE VENTAS
ADD FKCodFactura numeric(6)
CONSTRAINT FACTURA_VENTAS FOREIGN KEY
REFERENCES FACTURA(CodFactura)

/*RESTRICCIONES*/

USE FOODTRUCKS
ALTER TABLE PRODUCTOS  
ADD CONSTRAINT chkRowCount 
CHECK (CategoriaProd >= 1 AND CategoriaProd <=3 );  
GO  

USE FOODTRUCKS
ALTER TABLE FORMA_PAGO  
ADD CONSTRAINT chkRowFormaPago 
CHECK (FormaPago >= 1 AND FormaPago <=3 );  
GO  


/* INGRESAR POR LO MENOS 10 REGISTROS Y 20 EN LA TABLA DE FACTURAS*/

/*INGRESO DE DATOS DE CLIENTES*/

SELECT*FROM CLIENTES

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre1','Apellido1',1720804432,
'Direccion1','1/1/1999',09987178186,
'nombre1@hotmail.es')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre2','Apellido2',1720801917,
'Direccion2','4/2/1998',0992514455,
'nombre2@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre3','Apellido3',1720801909,
'Direccion3','6/3/1997',0999999999,
'nombre3@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre4','Apellido4',1720801908,'Direccion4','8/4/2000',0999999990,'nombre4@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre5','Apellido5',1720801907,'Direccion5','10/5/2001',0999999900,'nombre4@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre6','Apellido6',1720801906,'Direccion6','12/6/1996',0999999000,'nombre6@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre7N','Apellido7',1724437100,'Direccion7','9/27/2001',0959220244,'nombre7@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre8','Apellido8',1720801905,'Direccion8','8/16/1995',0999990000,'nombre8@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre9','Apellido9',1720801904,'Direccion9','9/18/1996',0999900000,'nombre9@hotmail.com')

USE FOODTRUCKS
INSERT INTO CLIENTES
VALUES('Nombre10','Apellido10',1720801903,'Direccion10','10/20/1997',0999000000,'nombre10@hotmail.com')

/*INGRESO DE DATOS ADMINISTRADOR*/
SELECT* FROM ADMINISTRADOR

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin1','A1',0120804455,'dir1',
'01/30/1996',0987654321,'admin1@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin2','A2',0120804454,'dir2',
'11/22/1995',0987654320,'admin2@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin3','A3',0120804453,'dir3',
'12/24/1997',0987654300,'admin3@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin4','A4',0120804452,'dir4','02/02/1996',0987654000,'admin4@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin5','A5',0120804451,'dir5','04/12/1998',0987650000,'admin5@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin6','A6',0120804450,'dir6','06/11/1999',0987600000,'admin6@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin7','A7',0120804449,'dir7','05/10/2000',0987000000,'admin7@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin8','A8',0120804448,'dir8','04/16/2001',0980000000,'admin8@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin9','A9',0120804447,'dir9','03/15/1999',0900000000,'admin9@hotmail.com')

USE FOODTRUCKS
INSERT INTO ADMINISTRADOR
VALUES('Admin10','A10',0120804446,'dir10','02/14/1999',0912345678,'admin10@hotmail.com')

/*INGRESO DE DATOS PRODUCTOS*/

SELECT*FROM PRODUCTOS

/*PLATOS FUERTES*/
USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(001,'Enchiladas',3.00,40,1) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(002,'Chilaquiles',4.50,30,1) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(003,'Chiles rellenos',5.00,35,1) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(004,'Quesadillas',3.50,45,1) 

/*POSTRES*/
USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(005,'Pastel tres leches',1.50,30,3) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(006,'Pastel imposible', 2.00,40,3) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(007,'Jericalla', 2.50,37,3) 


/*SOPAS*/
USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(008,'Sopa de tortilla', 2.5,43,2) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(009,'Crema poblana', 2.0,38,2) 

USE FOODTRUCKS
INSERT INTO PRODUCTOS
VALUES(010,'Sopa tarasca', 2.5,48,2) 

/*platos fuertes
-Enchiladas 3.00
-Chilaquiles  4.50
-Chiles rellenos 5.00
-Quesadillas 3.50

postres
-Pastel tres leches 1.50
-Pastel imposible 2.00
-Jericalla 2.50

sopas
-Sopa de tortilla 2.5
-Crema poblana 2.0
-Sopa tarasca 2.5 */

/*INGRESO DE DATOS FACTURA*/
SELECT* FROM ADMINISTRADOR
SELECT* FROM CLIENTES
SELECT* FROM FACTURA
SELECT* FROM PRODUCTOS

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(1,'01/25/2019',3.00,3,9.00,0.90,8.1,
1720801905,1,120804446)
USE FOODTRUCKS

INSERT INTO FACTURA
VALUES(2,'01/25/2019',4.50,2,9.00,0.90,8.1,
1720801904,2,120804447)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(3,'01/25/2019',5.00,1,5.00,0.50,4.5,
1720801903,3,120804448)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(4,'01/28/2019',2.50,4,10.00,1.00,9.0,1720801906,10,120804449)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(5,'01/28/2019',2.00,3,6.00,0.60,5.4,1720801907,9,120804450)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(6,'01/28/2019',2.50,3,7.50,0.75,6.75,1720801908,8,120804451)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(7,'01/29/2019',3.50,2,7.00,0.70,6.30,1720801909,4,120804452)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(6,'01/29/2019',1.50,6,9.00,0.90,8.1,1720801917,5,120804453)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(7,'01/29/2019',2.00,5,10.00,1.00,9.00,1720804432,6,120804454)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(8,'01/30/2019',2.50,5,12.50,1.25,11.25,1724437100,7,120804455)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(9,'01/30/2019',2.00,1,2.00,0.20,1.80,1720801903,6,120804454)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(10,'01/30/2019',1.50,3,4.50,0.45,4.05,1720801904,5,120804453)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(11,'01/30/2019',2.50,4,10.00,1.00,9.00,1720801905,7,120804453)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(12,'01/31/2019',2.50,2,5.00,0.50,4.50,1720801904,8,120804454)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(13,'01/31/2019',2.00,2,4.00,0.40,3.60,1720801903,9,120804455)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(12,'01/31/2019',1.50,3,4.50,0.45,4.05,1724437100,5,120804454)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(13,'01/31/2019',3.50,3,10.50,1.05,9.45,1720804432,4,120804453)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(14,'01/31/2019',5.00,4,20.00,2.00,18.00,1720801917,3,120804452)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(15,'02/01/2019',2.50,3,7.50,0.75,6.75,1720801909,10,120804451)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(16,'02/01/2019',2.00,4,8.00,0.80,7.2,1720801908,9,120804450)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(17,'02/04/2019',2.50,3,7.50,0.75,6.75,1720801907,8,120804449)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(18,'02/04/2019',4.50,4,18.00,1.80,16.2,1720801906,2,120804448)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(19,'02/05/2019',3.00,2,6.00,0.60,5.40,1720801903,1,120804447)

USE FOODTRUCKS
INSERT INTO FACTURA
VALUES(20,'02/05/2019',4.50,6,27.00,2.70,24.30,1720801904,2,120804446)

/*clientes
1720801903 --> 10
1720801904 --> 9
1720801905 --> 8
1720801906 --> 6
1720801907 --> 5
1720801908 --> 4
1720801909 --> 3
1720801917 --> 2
1720804432 --> 1
1724437100 --> 7 

Administracion
120804446
120804447
120804448
120804449
120804450
120804451
120804452
120804453
120804454
120804455
*/

/*INGRESO DE DATOS FORMA_PAGO*/

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(1,1,1,1720801905,120804446)
USE FOODTRUCKS

INSERT INTO FORMA_PAGO
VALUES(2,3,2,1720801904,120804447)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(3,2,3,1720801903,120804448)

SELECT*FROM FORMA_PAGO

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(4,3,4,1720801906,120804449)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(5,2,5,1720801907,120804450)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(6,1,6,1720801908,120804451)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(7,2,7,1720801909,120804452)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(8,1,8,1724437100,120804455)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(9,1,9,1720801903,120804454)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(10,1,10,1720801904,120804453)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(11,1,11,1720801905,120804453)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(12,2,12,1720801904,120804454)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(13,2,13,1720801903,120804455)


USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(14,2,14,1720801917,120804452)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(15,1,15,1720801909,120804451)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(16,1,16,1720801908,120804450)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(17,2,17,1720801907,120804449)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(18,3,18,1720801906,120804448)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(19,3,19,1720801903,120804447)

USE FOODTRUCKS
INSERT INTO FORMA_PAGO
VALUES(20,1,20,1720801904,120804446)

/*INGRESO DE DATOS INVENTARIOS*/

select* from ADMINISTRADOR
USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES(1,'Tomates',100,1,120804449)

USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES(2,'Lechugas',45,1,120804452)

USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (3, 'Tortillas' , 84,1, 120804446)

USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (4, 'Chile' , 250,1, 120804447)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (5, 'Huevos' , 500,1, 120804448)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (6, 'Harina' , 25,1, 120804450)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (7, 'Frejol' , 150 ,1, 120804451)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (8, 'Pollo' , 20,1, 120804452)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (9, 'Carne' , 100,1, 120804453)


USE FOODTRUCKS
INSERT INTO INVENTARIOS
VALUES (10, 'Res' , 100 ,1, 120804454)

select*from INVENTARIOS
/*SPRIPT CREACION DE LAS TABLAS*/

/*SPRIPT INGRESO DE DATOS */

/*CREACION DE DOS VISTAS POR INTERES*/

/*SCRIPT DE UN TRIGGER QUE DEBA RESTRINGIR UNA COMPRA CUANDO 
EL VALOR SUPERE UN MONTO DETERMINADO*/

/*SPRIPT DE LA CREACION DE UN PROCEDIMIENTO ALMACENANDO QUE 
SE ACTUALICE LAS COMPRAS DIARIAS*/

ALTER TABLE INVENTARIOS
ALTER COLUMN Estado bit not null; 

create procedure listarInv
as
select * from  INVENTARIOS where Estado=1
go

select CodInv,Insumo,Existencias 
from INVENTARIOS

select CodFactura,FechFactura,FK_CodProd,NomProd,
PrecioUnit,Cantidad,Descuento,APagar 
from FACTURA,PRODUCTOS 
where FACTURA.FK_CodProd=PRODUCTOS.CodProd

select*from ADMINISTRADOR

use FOODTRUCKS
alter table FACTURA
alter column FechFactura varchar(25)
